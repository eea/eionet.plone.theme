<tal:script i18n:domain="eionet.theme"
    tal:define="set_mimetype python:request.response.setHeader('Content-Type', 'text/javascript');">

$(document).ready(function() {
  calendarEl = document.getElementById('calendar');
  calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: 'dayGridMonth',
    editable: false,
    selectable: true,
    events: {
      url: ($('base').attr('href') || $('body').data('base-url')) + "/calendar_update?view=dayGridMonth",
    },
    views: {
      consultations: {
        type: 'listYear',
        buttonText: 'Consultations'
      },
      events: {
        type: 'listYear',
        buttonText: 'Events'
      },
      publications: {
        type: 'listYear',
        buttonText: 'Publications'
      },
      reporting: {
        type: 'listYear',
        buttonText: 'Reporting'
      },
    },
    headerToolbar: {
      left: 'prev,next today',
      center: 'title',
      right: 'dayGridMonth,events,publications,consultations,reporting'
    },
    buttonText: {
      prev: '<',
      next: '>',
      prevYear: '<<',
      nextYear: '>>'
    },
    datesSet: function(info){
      var source = info.view.calendar.getEventSources()[0]
      if (source.url.indexOf('view=' + info.view.type) == -1){
        info.view.calendar.getEventSources()[0].remove();
        info.view.calendar.addEventSource(
          ($('base').attr('href') || $('body').data('base-url')) + "/calendar_update?view=" + info.view.type);
      }
    },
    firstDay: <span tal:replace="view/first_day">1</span>,
    displayEventEnd: true,
    /*eventDidMount: function(info) {
      var tooltip = new Tooltip(info.el, {
        title: info.event.extendedProps.description,
        placement: 'top',
        trigger: 'hover',
        container: 'body'
      });
    },*/
  });
  calendar.render();
  /*$('#calendar').fullCalendar({
        <span tal:omit-tag="" tal:condition="view/can_add_content">
        dayClick: function(date, allDay, jsEvent, view) {
            var title = prompt('<tal:trans i18n:translate="insert_title_prompt">Please insert a title for the new event.</tal:trans>');
            if (title == null || title.length == 0) return;

            window.location.href = "./calendar_add?" + $.param({'title': title, 'startdate': Math.round(date.getTime() / 1000)})
        },
        </span>
        eventDrop: function(event, dayDelta, minuteDelta) {
            $.ajax({
                type: 'POST',
                url: './calendar_drop',
                data: {
                    'event': event.id,
                    'dayDelta': dayDelta,
                    'minuteDelta': minuteDelta
                },
                success: function(msg) {
                }
            });
        },
        eventResize: function(event, dayDelta, minuteDelta, revertFunc) {
            $.ajax({
                type: 'POST',
                url: './calendar_resize',
                data: {
                    'event': event.id,
                    'dayDelta': dayDelta,
                    'minuteDelta': minuteDelta
                },
                success:   function(msg) {
                },
                error: revertFunc
            });
        },
        loading: function(bool) {
            if (bool) {
                $('#kss-spinner').show();
            } else {
                $('#kss-spinner').hide();
            }
        }

  });*/
});

</tal:script>
